(function(d,b,f){var c="pep";var e={initiate:function(){},start:function(){},drag:function(){},stop:function(){},easing:null,rest:function(){},moveTo:!1,callIfNotStarted:["stop","rest"],startThreshold:[0,0],grid:[1,1],debug:!1,activeClass:"pep-active",multiplier:1,velocityMultiplier:2.5,shouldPreventDefault:!0,allowDragEventPropagation:!0,stopEvents:"",hardwareAccelerate:!0,useCSSTranslation:!0,disableSelect:!0,cssEaseString:"cubic-bezier(0.190, 1.000, 0.220, 1.000)",cssEaseDuration:1000,shouldEase:!0,droppable:!1,droppableActiveClass:"pep-dpa",overlapFunction:!1,constrainTo:!1,removeMargins:!0,place:!0,deferPlacement:!1,axis:null,forceNonCSS3Movement:!1,elementsWithInteraction:"input",revert:!1,revertAfter:"stop",revertIf:function(){return !0},ignoreRightClick:!0};function a(h,g){this.name=c;this.el=h;this.$el=d(h);this.options=d.extend({},e,g);this.$document=d(this.$el[0].ownerDocument);this.$body=this.$document.find("body");this.moveTrigger="MSPointerMove touchmove mousemove";this.startTrigger="MSPointerDown touchstart mousedown";this.stopTrigger="MSPointerUp touchend mouseup";this.startTriggerArray=this.startTrigger.split(" ");this.moveTriggerArray=this.moveTrigger.split(" ");this.stopTriggerArray=this.stopTrigger.split(" ");this.stopEvents=[this.stopTrigger,this.options.stopEvents].join(" ");if(this.options.constrainTo==="window"){this.$container=this.$document}else{if(this.options.constrainTo&&(this.options.constrainTo!=="parent")){this.$container=d(this.options.constrainTo)}else{this.$container=this.$el.parent()}}if(this.isPointerEventCompatible()){this.applyMSDefaults()}this.CSSEaseHash=this.getCSSEaseHash();this.scale=1;this.started=!1;this.disabled=!1;this.activeDropRegions=[];this.resetVelocityQueue();this.init();return this}a.prototype.init=function(){if(this.options.debug){this.buildDebugDiv()}if(this.options.disableSelect){this.disableSelect()}if(this.options.place&&!this.options.deferPlacement){this.positionParent();this.placeObject()}this.ev={};this.pos={};this.subscribe()};a.prototype.subscribe=function(){var g=this;this.onStartEvent=function(h){g.handleStart(h)};this.$el.on(this.startTrigger,this.onStartEvent);this.onStartEventOnElementsWithInteraction=function(h){h.stopPropagation()};this.$el.on(this.startTrigger,this.options.elementsWithInteraction,this.onStartEventOnElementsWithInteraction);this.onStopEvents=function(h){g.handleStop(h)};this.$document.on(this.stopEvents,this.onStopEvents);this.onMoveEvents=function(h){g.moveEvent=h};this.$document.on(this.moveTrigger,this.onMoveEvents)};a.prototype.unsubscribe=function(){this.$el.off(this.startTrigger,this.onStartEvent);this.$el.off(this.startTrigger,this.options.elementsWithInteraction,this.onStartEventOnElementsWithInteraction);this.$document.off(this.stopEvents,this.onStopEvents);this.$document.off(this.moveTrigger,this.onMoveEvents)};a.prototype.handleStart=function(j){var g=this;if(this.isValidMoveEvent(j)&&!this.disabled){if(!(this.options.ignoreRightClick&&j.which===3)){if(this.isPointerEventCompatible()&&j.preventManipulation){j.preventManipulation()}j=this.normalizeEvent(j);if(this.options.place&&this.options.deferPlacement){this.positionParent();this.placeObject()}this.log({type:"event",event:j.type});if(this.options.hardwareAccelerate&&!this.hardwareAccelerated){this.hardwareAccelerate();this.hardwareAccelerated=!0}var i=this.options.initiate.call(this,j,this);if(i===!1){return}clearTimeout(this.restTimeout);this.$el.addClass(this.options.activeClass);this.removeCSSEasing();this.startX=this.ev.x=j.pep.x;this.startY=this.ev.y=j.pep.y;this.initialPosition=this.initialPosition||this.$el.position();this.startEvent=this.moveEvent=j;this.active=!0;if(this.options.shouldPreventDefault){j.preventDefault()}if(!this.options.allowDragEventPropagation){j.stopPropagation()}(function h(){if(!g.active){return}g.handleMove();g.requestAnimationFrame(h)})();(function k(){if(!g.options.easing){return}if(g.easing){g.options.easing.call(g,null,g)}g.requestAnimationFrame(k)})()}}};a.prototype.handleMove=function(){if(typeof(this.moveEvent)==="undefined"){return}var n=this.normalizeEvent(this.moveEvent);var k=b.parseInt(n.pep.x/this.options.grid[0])*this.options.grid[0];var g=b.parseInt(n.pep.y/this.options.grid[1])*this.options.grid[1];this.addToLIFO({time:n.timeStamp,x:k,y:g});var m,j;if(d.inArray(n.type,this.startTriggerArray)>-1){m=0;j=0}else{m=k-this.ev.x;j=g-this.ev.y}this.dx=m;this.dy=j;this.ev.x=k;this.ev.y=g;if(m===0&&j===0){this.log({type:"event",event:"** stopped **"});return}var l=Math.abs(this.startX-k);var i=Math.abs(this.startY-g);if(!this.started&&(l>this.options.startThreshold[0]||i>this.options.startThreshold[1])){this.started=!0;this.$el.addClass("pep-start");this.options.start.call(this,this.startEvent,this)}if(this.options.droppable){this.calculateActiveDropRegions()}var h=this.options.drag.call(this,n,this);if(h===!1){this.resetVelocityQueue();return}this.log({type:"event",event:n.type});this.log({type:"event-coords",x:this.ev.x,y:this.ev.y});this.log({type:"velocity"});this.doMoveTo(m,j)};a.prototype.doMoveTo=function(i,h){var k=this.handleConstraint(i,h);var j,g;if(typeof this.options.moveTo==="function"){j=(i>=0)?"+="+Math.abs(i/this.scale)*this.options.multiplier:"-="+Math.abs(i/this.scale)*this.options.multiplier;g=(h>=0)?"+="+Math.abs(h/this.scale)*this.options.multiplier:"-="+Math.abs(h/this.scale)*this.options.multiplier;if(this.options.constrainTo){j=(k.x!==!1)?k.x:j;g=(k.y!==!1)?k.y:g}if(this.options.axis==="x"){g=k.y}if(this.options.axis==="y"){j=k.x}this.options.moveTo.call(this,j,g)}else{if(!this.shouldUseCSSTranslation()){j=(i>=0)?"+="+Math.abs(i/this.scale)*this.options.multiplier:"-="+Math.abs(i/this.scale)*this.options.multiplier;g=(h>=0)?"+="+Math.abs(h/this.scale)*this.options.multiplier:"-="+Math.abs(h/this.scale)*this.options.multiplier;if(this.options.constrainTo){j=(k.x!==!1)?k.x:j;g=(k.y!==!1)?k.y:g}if(this.options.axis==="x"){g=k.y}if(this.options.axis==="y"){j=k.x}this.moveTo(j,g)}else{i=(i/this.scale)*this.options.multiplier;h=(h/this.scale)*this.options.multiplier;if(this.options.constrainTo){i=(k.x===!1)?i:0;h=(k.y===!1)?h:0}if(this.options.axis==="x"){h=0}if(this.options.axis==="y"){i=0}this.moveToUsingTransforms(i,h)}}};a.prototype.handleStop=function(g){if(!this.active){return}this.log({type:"event",event:g.type});this.active=!1;this.easing=!0;this.$el.removeClass("pep-start").addClass("pep-ease");if(this.options.droppable){this.calculateActiveDropRegions()}if(this.started||(!this.started&&d.inArray("stop",this.options.callIfNotStarted)>-1)){this.options.stop.call(this,g,this)}if(this.options.shouldEase){this.ease(g,this.started)}else{this.removeActiveClass()}if(this.options.revert&&(this.options.revertAfter==="stop"||!this.options.shouldEase)&&(this.options.revertIf&&this.options.revertIf.call(this))){this.revert()}this.started=!1;this.resetVelocityQueue()};a.prototype.ease=function(n,j){var l=this.$el.position();var p=this.velocity();var g=this.dt;var o=(p.x/this.scale)*this.options.multiplier;var m=(p.y/this.scale)*this.options.multiplier;var i=this.handleConstraint(o,m,!0);if(this.cssAnimationsSupported()){this.$el.css(this.getCSSEaseHash())}var k=(p.x>0)?"+="+o:"-="+Math.abs(o);var r=(p.y>0)?"+="+m:"-="+Math.abs(m);if(this.options.constrainTo){k=(i.x!==!1)?i.x:k;r=(i.y!==!1)?i.y:r}if(this.options.axis==="x"){r="+=0"}if(this.options.axis==="y"){k="+=0"}var h=!this.cssAnimationsSupported()||this.options.forceNonCSS3Movement;if(typeof this.options.moveTo==="function"){this.options.moveTo.call(this,k,r)}else{this.moveTo(k,r,h)}var q=this;this.restTimeout=setTimeout(function(){if(q.options.droppable){q.calculateActiveDropRegions()}q.easing=!1;if(j||(!j&&d.inArray("rest",q.options.callIfNotStarted)>-1)){q.options.rest.call(q,n,q)}if(q.options.revert&&(q.options.revertAfter==="ease"&&q.options.shouldEase)&&(q.options.revertIf&&q.options.revertIf.call(q))){q.revert()}q.removeActiveClass()},this.options.cssEaseDuration)};a.prototype.normalizeEvent=function(g){g.pep={};if(this.isPointerEventCompatible()||!this.isTouch(g)){if(g.pageX){g.pep.x=g.pageX;g.pep.y=g.pageY}else{g.pep.x=g.originalEvent.pageX;g.pep.y=g.originalEvent.pageY}g.pep.type=g.type}else{g.pep.x=g.originalEvent.touches[0].pageX;g.pep.y=g.originalEvent.touches[0].pageY;g.pep.type=g.type}return g};a.prototype.resetVelocityQueue=function(){this.velocityQueue=new Array(5)};a.prototype.moveTo=function(g,i,h){this.log({type:"delta",x:g,y:i});if(h){this.$el.animate({top:i,left:g},0,"easeOutQuad",{queue:!1})}else{this.$el.stop(!0,!1).css({top:i,left:g})}};a.prototype.moveToUsingTransforms=function(g,i){var h=this.matrixToArray(this.matrixString());if(!this.cssX){this.cssX=this.xTranslation(h)}if(!this.cssY){this.cssY=this.yTranslation(h)}this.cssX=this.cssX+g;this.cssY=this.cssY+i;this.log({type:"delta",x:g,y:i});h[4]=this.cssX;h[5]=this.cssY;this.translation=this.arrayToMatrix(h);this.transform(this.translation)};a.prototype.transform=function(g){this.$el.css({"-webkit-transform":g,"-moz-transform":g,"-ms-transform":g,"-o-transform":g,transform:g})};a.prototype.xTranslation=function(g){g=g||this.matrixToArray(this.matrixString());return parseInt(g[4],10)};a.prototype.yTranslation=function(g){g=g||this.matrixToArray(this.matrixString());return parseInt(g[5],10)};a.prototype.matrixString=function(){var h=function(i){return !(!i||i==="none"||i.indexOf("matrix")<0)};var g="matrix(1, 0, 0, 1, 0, 0)";if(h(this.$el.css("-webkit-transform"))){g=this.$el.css("-webkit-transform")}if(h(this.$el.css("-moz-transform"))){g=this.$el.css("-moz-transform")}if(h(this.$el.css("-ms-transform"))){g=this.$el.css("-ms-transform")}if(h(this.$el.css("-o-transform"))){g=this.$el.css("-o-transform")}if(h(this.$el.css("transform"))){g=this.$el.css("transform")}return g};a.prototype.matrixToArray=function(g){return g.split("(")[1].split(")")[0].split(",")};a.prototype.arrayToMatrix=function(g){return"matrix("+g.join(",")+")"};a.prototype.addToLIFO=function(h){var g=this.velocityQueue;g=g.slice(1,g.length);g.push(h);this.velocityQueue=g};a.prototype.velocity=function(){var j=0;var h=0;for(var g=0;g<this.velocityQueue.length-1;g++){if(this.velocityQueue[g]){j+=(this.velocityQueue[g+1].x-this.velocityQueue[g].x);h+=(this.velocityQueue[g+1].y-this.velocityQueue[g].y);this.dt=(this.velocityQueue[g+1].time-this.velocityQueue[g].time)}}return{x:j*this.options.velocityMultiplier,y:h*this.options.velocityMultiplier}};a.prototype.revert=function(){if(this.shouldUseCSSTranslation()){this.moveToUsingTransforms(-this.xTranslation(),-this.yTranslation())}this.moveTo(this.initialPosition.left,this.initialPosition.top)};a.prototype.requestAnimationFrame=function(g){return b.requestAnimationFrame&&b.requestAnimationFrame(g)||b.webkitRequestAnimationFrame&&b.webkitRequestAnimationFrame(g)||b.mozRequestAnimationFrame&&b.mozRequestAnimationFrame(g)||b.oRequestAnimationFrame&&b.mozRequestAnimationFrame(g)||b.msRequestAnimationFrame&&b.msRequestAnimationFrame(g)||b.setTimeout(g,1000/60)};a.prototype.positionParent=function(){if(!this.options.constrainTo||this.parentPositioned){return}this.parentPositioned=!0;if(this.options.constrainTo==="parent"){this.$container.css({position:"relative"})}else{if(this.options.constrainTo==="window"&&this.$container.get(0).nodeName!=="#document"&&this.$container.css("position")!=="static"){this.$container.css({position:"static"})}}};a.prototype.placeObject=function(){if(this.objectPlaced){return}this.objectPlaced=!0;this.offset=(this.options.constrainTo==="parent"||this.hasNonBodyRelative())?this.$el.position():this.$el.offset();if(parseInt(this.$el.css("left"),10)){this.offset.left=this.$el.css("left")}if(parseInt(this.$el.css("top"),10)){this.offset.top=this.$el.css("top")}if(this.options.removeMargins){this.$el.css({margin:0})}this.$el.css({position:"absolute",top:this.offset.top,left:this.offset.left})};a.prototype.hasNonBodyRelative=function(){return this.$el.parents().filter(function(){var g=d(this);return g.is("body")||g.css("position")==="relative"}).length>1};a.prototype.setScale=function(g){this.scale=g};a.prototype.setMultiplier=function(g){this.options.multiplier=g};a.prototype.removeCSSEasing=function(){if(this.cssAnimationsSupported()){this.$el.css(this.getCSSEaseHash(!0))}};a.prototype.disableSelect=function(){this.$el.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"})};a.prototype.removeActiveClass=function(){this.$el.removeClass([this.options.activeClass,"pep-ease"].join(" "))};a.prototype.handleConstraint=function(o,n,g){var k=this.$el.position();this.pos.x=k.left;this.pos.y=k.top;var h={x:!1,y:!1};var l,i,j,m;this.log({type:"pos-coords",x:this.pos.x,y:this.pos.y});if(d.isArray(this.options.constrainTo)){if(this.options.constrainTo[3]!==f&&this.options.constrainTo[1]!==f){i=this.options.constrainTo[1]===!1?Infinity:this.options.constrainTo[1];j=this.options.constrainTo[3]===!1?-Infinity:this.options.constrainTo[3]}if(this.options.constrainTo[0]!==!1&&this.options.constrainTo[2]!==!1){l=this.options.constrainTo[2]===!1?Infinity:this.options.constrainTo[2];m=this.options.constrainTo[0]===!1?-Infinity:this.options.constrainTo[0]}if(this.pos.x+o<j){h.x=j}if(this.pos.y+n<m){h.y=m}}else{if(typeof this.options.constrainTo==="string"){j=0;m=0;i=this.$container.width()-this.$el.outerWidth();l=this.$container.height()-this.$el.outerHeight();if(this.pos.x+o<0){h.x=0}if(this.pos.y+n<0){h.y=0}}}if(this.pos.x+o>i){h.x=i}if(this.pos.y+n>l){h.y=l}if(this.shouldUseCSSTranslation()&&g){if(h.x===j&&this.xTranslation()){h.x=j-this.xTranslation()}if(h.x===i&&this.xTranslation()){h.x=i-this.xTranslation()}if(h.y===m&&this.yTranslation()){h.y=m-this.yTranslation()}if(h.y===l&&this.yTranslation()){h.y=l-this.yTranslation()}}return h};a.prototype.getCSSEaseHash=function(g){if(typeof(g)==="undefined"){g=!1}var h;if(g){h=""}else{if(this.CSSEaseHash){return this.CSSEaseHash}else{h=["all",this.options.cssEaseDuration+"ms",this.options.cssEaseString].join(" ")}}return{"-webkit-transition":h,"-moz-transition":h,"-ms-transition":h,"-o-transition":h,transition:h}};a.prototype.calculateActiveDropRegions=function(){var g=this;this.activeDropRegions.length=0;d.each(d(this.options.droppable),function(h,j){var i=d(j);if(g.isOverlapping(i,g.$el)){i.addClass(g.options.droppableActiveClass);g.activeDropRegions.push(i)}else{i.removeClass(g.options.droppableActiveClass)}})};a.prototype.isOverlapping=function(j,i){if(this.options.overlapFunction){return this.options.overlapFunction(j,i)}var h=j[0].getBoundingClientRect();var g=i[0].getBoundingClientRect();return !(h.right<g.left||h.left>g.right||h.bottom<g.top||h.top>g.bottom)};a.prototype.isTouch=function(g){return g.type.search("touch")>-1};a.prototype.isPointerEventCompatible=function(){return("MSPointerEvent" in b)};a.prototype.applyMSDefaults=function(g){this.$el.css({"-ms-touch-action":"none","touch-action":"none","-ms-scroll-chaining":"none","-ms-scroll-limit":"0 0 0 0"})};a.prototype.isValidMoveEvent=function(g){return(!this.isTouch(g)||(this.isTouch(g)&&g.originalEvent&&g.originalEvent.touches&&g.originalEvent.touches.length===1))};a.prototype.shouldUseCSSTranslation=function(){if(this.options.forceNonCSS3Movement){return !1}if(typeof(this.useCSSTranslation)!=="undefined"){return this.useCSSTranslation}var g=!1;if(!this.options.useCSSTranslation||(typeof(Modernizr)!=="undefined"&&!Modernizr.csstransforms)){g=!1}else{g=!0}this.useCSSTranslation=g;return g};a.prototype.cssAnimationsSupported=function(){if(typeof(this.cssAnimationsSupport)!=="undefined"){return this.cssAnimationsSupport}if((typeof(Modernizr)!=="undefined"&&Modernizr.cssanimations)){this.cssAnimationsSupport=!0;return !0}var k=!1,n=document.createElement("div"),m="animation",j="",h="Webkit Moz O ms Khtml".split(" "),l="";if(n.style.animationName){k=!0}if(k===!1){for(var g=0;g<h.length;g++){if(n.style[h[g]+"AnimationName"]!==f){l=h[g];m=l+"Animation";j="-"+l.toLowerCase()+"-";k=!0;break}}}this.cssAnimationsSupport=k;return k};a.prototype.hardwareAccelerate=function(){this.$el.css({"-webkit-perspective":1000,perspective:1000,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})};a.prototype.getMovementValues=function(){return{ev:this.ev,pos:this.pos,velocity:this.velocity()}};a.prototype.buildDebugDiv=function(){var h;if(d("#pep-debug").length===0){h=d("<div></div>");h.attr("id","pep-debug").append("<div style='font-weight:bold; background: #ff0000; color: white;'>DEBUG MODE</div>").append("<div id='pep-debug-event'>no event</div>").append("<div id='pep-debug-ev-coords'>event coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-pos-coords'>position coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-velocity'>velocity: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-delta'>&Delta; movement: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").css({position:"fixed",bottom:5,right:5,zIndex:99999,textAlign:"right",fontFamily:"Arial, sans",fontSize:10,border:"1px solid #DDD",padding:"3px",background:"white",color:"#333"})}var g=this;setTimeout(function(){g.debugElements={$event:d("#pep-debug-event"),$velocityX:d("#pep-debug-velocity .pep-x"),$velocityY:d("#pep-debug-velocity .pep-y"),$dX:d("#pep-debug-delta .pep-x"),$dY:d("#pep-debug-delta .pep-y"),$evCoordsX:d("#pep-debug-ev-coords .pep-x"),$evCoordsY:d("#pep-debug-ev-coords .pep-y"),$posCoordsX:d("#pep-debug-pos-coords .pep-x"),$posCoordsY:d("#pep-debug-pos-coords .pep-y")}},0);d("body").append(h)};a.prototype.log=function(h){if(!this.options.debug){return}switch(h.type){case"event":this.debugElements.$event.text(h.event);break;case"pos-coords":this.debugElements.$posCoordsX.text(h.x);this.debugElements.$posCoordsY.text(h.y);break;case"event-coords":this.debugElements.$evCoordsX.text(h.x);this.debugElements.$evCoordsY.text(h.y);break;case"delta":this.debugElements.$dX.text(h.x);this.debugElements.$dY.text(h.y);break;case"velocity":var g=this.velocity();this.debugElements.$velocityX.text(Math.round(g.x));this.debugElements.$velocityY.text(Math.round(g.y));break}};a.prototype.toggle=function(g){if(typeof(g)==="undefined"){this.disabled=!this.disabled}else{this.disabled=!g}};d.extend(d.easing,{easeOutQuad:function(h,i,g,k,j){return -k*(i/=j)*(i-2)+g},easeOutCirc:function(h,i,g,k,j){return k*Math.sqrt(1-(i=i/j-1)*i)+g},easeOutExpo:function(h,i,g,k,j){return(i===j)?g+k:k*(-Math.pow(2,-10*i/j)+1)+g}});d.fn[c]=function(g){return this.each(function(){if(!d.data(this,"plugin_"+c)){var h=new a(this,g);d.data(this,"plugin_"+c,h);d.pep.peps.push(h)}})};d.pep={};d.pep.peps=[];d.pep.toggleAll=function(g){d.each(this.peps,function(h,i){i.toggle(g)})};d.pep.unbind=function(h){var g=h.data("plugin_"+c);if(typeof g==="undefined"){return}g.toggle(!1);g.unsubscribe();h.removeData("plugin_"+c)}}(jQuery,window));